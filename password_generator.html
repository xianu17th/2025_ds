<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>パスワード作成ツール</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#7c5cff;
      --accent-2:#00d4ff;
      --glass: rgba(255,255,255,0.04);
      --success:#2ecc71;
      --danger:#ff6b6b;
      --radius:14px;
      font-family: Inter, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.12), transparent),
                  radial-gradient(900px 400px at 90% 90%, rgba(0,212,255,0.07), transparent),
                  var(--bg);
      color:#ecf0f6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
    }

    .card{
      width:100%;
      max-width:920px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:28px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.03);
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:24px;
    }

    header{
      grid-column:1 / -1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:6px;
    }
    h1{margin:0;font-size:20px;letter-spacing:-0.2px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .controls{padding:14px;background:var(--glass);border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .control-row{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    label.switch{display:flex;align-items:center;gap:10px;cursor:pointer}

    input[type="range"]{width:100%}
    .range-wrap{display:flex;align-items:center;gap:12px}
    .range-value{min-width:36px;text-align:center;font-weight:600}

    .checkbox-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .checkbox{display:flex;gap:10px;align-items:center}
    input[type=checkbox]{width:18px;height:18px}

    .output{
      display:flex;flex-direction:column;gap:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);
    }

    .password-box{
      display:flex;gap:12px;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.18);padding:12px;border-radius:10px;font-family:monospace;font-size:16px;
      word-break:break-all
    }
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white
    }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}

    .col-opts{display:flex;flex-direction:column;gap:12px}

    .meta{font-size:13px;color:var(--muted)}

    .strength{
      height:12px;border-radius:999px;background:rgba(255,255,255,0.06);overflow:hidden
    }
    .strength > span{display:block;height:100%;width:0%;transition:width 300ms ease}

    .right-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
      padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px;align-items:stretch
    }

    .sample-list{font-family:monospace;font-size:13px;color:var(--muted);background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}

    footer{grid-column:1 / -1;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;margin-top:8px}

    @media (max-width:840px){
      .card{grid-template-columns:1fr;}
      .right-card{order:2}
    }

    /* small helper */
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <main class="card" role="main">
    <header>
      <div>
        <h1>ランダムパスワード作成ツール</h1>
        <p class="lead">英字（大・小文字）／数字／特殊文字（_ など）を組み合わせて安全なパスワードを生成します。</p>
      </div>
      <div class="meta">安全性の高い乱数: <strong>crypto.getRandomValues</strong> を使用</div>
    </header>

    <section class="controls">
      <div class="control-row">
        <label for="length">長さ</label>
        <div class="range-wrap" style="flex:1">
          <input id="length" type="range" min="6" max="64" value="16" />
          <div class="range-value" id="lengthValue">16</div>
        </div>
      </div>

      <div class="checkbox-grid">
        <label class="checkbox"><input id="upper" type="checkbox" checked /> 大文字 (A-Z)</label>
        <label class="checkbox"><input id="lower" type="checkbox" checked /> 小文字 (a-z)</label>
        <label class="checkbox"><input id="numbers" type="checkbox" checked /> 数字 (0-9)</label>
        <label class="checkbox"><input id="symbols" type="checkbox" checked /> 記号 (_ - ! @ # $ % & * ? 等)</label>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
        <button id="generate" class="btn">生成</button>
        <button id="copyBtn" class="btn ghost">コピー</button>
        <button id="shuffleBtn" class="btn ghost">別の候補</button>
      </div>

      <div style="margin-top:12px" class="output">
        <div class="password-box" aria-live="polite" id="password">ここに生成されたパスワードが表示されます</div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
          <div style="flex:1">
            <div class="small">推定強度</div>
            <div class="strength" aria-hidden="true"><span id="strengthBar" style="width:0%"></span></div>
            <div class="small" id="entropyText">エントロピー: 0 bits</div>
          </div>
          <div style="width:180px;text-align:right">
            <div class="small">記憶性のヒント</div>
            <div class="small">パスワードを安全に保管してください。</div>
          </div>
        </div>
      </div>
    </section>

    <aside class="right-card">
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>例（生成された候補）</strong>
          <button id="regenSmall" class="btn ghost" style="padding:6px 8px;font-size:13px">更新</button>
        </div>
        <pre class="sample-list" id="samples" aria-hidden="false">例: -- ここにサンプルが表示されます --</pre>
      </div>

      <div>
        <strong>使い方</strong>
        <ol class="small" style="padding-left:18px;margin:6px 0">
          <li>スライダーで長さを選択</li>
          <li>使用する文字種類を選ぶ（大文字/小文字/数字/記号）</li>
          <li>「生成」ボタンでパスワードを作成</li>
          <li>必要ならコピーして管理ツールに保存</li>
        </ol>
      </div>

      <div>
        <strong>注意</strong>
        <p class="small">このツールはブラウザ上で動作します。パスワードは端末に一時的に表示されますので、公共端末での利用にはご注意ください。</p>
      </div>
    </aside>

    <footer>
      <div class="small">このページはオフラインで動作します</div>
      <div class="small">特殊文字セット: <code>_ - ! @ # $ % & * ? + =</code></div>
    </footer>
  </main>

  <script>
    // 文字セット
    const CHAR = {
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      lower: 'abcdefghijklmnopqrstuvwxyz',
      numbers: '0123456789',
      symbols: '_-!@#$%&*?+=',
    };

    const $ = id => document.getElementById(id);
    const lengthInput = $('length');
    const lengthValue = $('lengthValue');
    const passwordBox = $('password');
    const strengthBar = $('strengthBar');
    const entropyText = $('entropyText');
    const samplesEl = $('samples');

    function getSelectedCharset(){
      let set = '';
      if($('upper').checked) set += CHAR.upper;
      if($('lower').checked) set += CHAR.lower;
      if($('numbers').checked) set += CHAR.numbers;
      if($('symbols').checked) set += CHAR.symbols;
      return set;
    }

    // 安全な乱数でインデックスを生成
    function secureRandomIndices(count, max){
      // return array of random integers [0, max)
      const bytes = new Uint32Array(count);
      crypto.getRandomValues(bytes);
      return Array.from(bytes, b => b % max);
    }

    function generatePassword(len){
      const charset = getSelectedCharset();
      if(!charset) return '';
      const indices = secureRandomIndices(len, charset.length);
      let out = '';
      for(let i=0;i<len;i++) out += charset.charAt(indices[i]);
      return out;
    }

    function estimateEntropy(length, charsetSize){
      if(charsetSize <= 0) return 0;
      // entropy = log2(charsetSize^length) = length * log2(charsetSize)
      return Math.round(length * Math.log2(charsetSize));
    }

    function updateStrength(password){
      const charsetSize = new Set(getSelectedCharset()).size;
      const entropy = estimateEntropy(password.length || Number(lengthInput.value), charsetSize);
      entropyText.textContent = `エントロピー: ${entropy} bits`;
      // map entropy to percentage (arbitrary mapping): 0..128 bits -> 0..100
      const pct = Math.min(100, Math.round((entropy / 128) * 100));
      strengthBar.style.width = pct + '%';
      // color coding
      if(pct < 35){
        strengthBar.style.background = 'linear-gradient(90deg,var(--danger),#ffb6b6)';
      } else if(pct < 65){
        strengthBar.style.background = 'linear-gradient(90deg,#f6d365,#fda085)';
      } else if(pct < 90){
        strengthBar.style.background = 'linear-gradient(90deg,#9be15d,#00e3ae)';
      } else {
        strengthBar.style.background = 'linear-gradient(90deg,var(--success),#b0f3c1)';
      }
    }

    function generateAndShow(){
      const len = Number(lengthInput.value);
      const pwd = generatePassword(len);
      if(!pwd){
        passwordBox.textContent = '文字種が選択されていません。';
        return;
      }
      passwordBox.textContent = pwd;
      updateStrength(pwd);
      // update sample list
      renderSamples();
    }

    function renderSamples(){
      const prev = [];
      for(let i=0;i<6;i++){
        const s = generatePassword(Math.max(8, Number(lengthInput.value)));
        prev.push(s);
      }
      samplesEl.textContent = prev.join('\n');
    }

    // events
    lengthInput.addEventListener('input', ()=>{
      lengthValue.textContent = lengthInput.value;
    });

    $('generate').addEventListener('click', ()=>{
      generateAndShow();
    });

    $('copyBtn').addEventListener('click', async ()=>{
      const text = passwordBox.textContent.trim();
      if(!text) return;
      try{
        await navigator.clipboard.writeText(text);
        $('copyBtn').textContent = 'コピーしました';
        setTimeout(()=> $('copyBtn').textContent = 'コピー', 1400);
      }catch(e){
        alert('コピーに失敗しました。ブラウザのクリップボードアクセスを確認してください。');
      }
    });

    $('shuffleBtn').addEventListener('click', ()=>{
      // keep same length and charset, generate new
      const len = Number(lengthInput.value);
      const newp = generatePassword(len);
      if(newp) passwordBox.textContent = newp;
      updateStrength(passwordBox.textContent);
      renderSamples();
    });

    $('regenSmall').addEventListener('click', renderSamples);

    // regenerate samples when options change
    const inputs = Array.from(document.querySelectorAll('input[type=checkbox]'));
    inputs.forEach(i=> i.addEventListener('change', renderSamples));

    // initial render
    lengthValue.textContent = lengthInput.value;
    renderSamples();
    // create an initial main password
    generateAndShow();
  </script>
</body>
</html>
